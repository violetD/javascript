((function(){var a,b,c,d,e;a=0,b=["ms","moz","webkit","o"],d=function(a){if(!window.requestAnimationFrame)return window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"]};for(c=0,e=b.length;0<=e?c<=e:c>=e;0<=e?c++:c--)d.call(this,c);window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return d=(new Date).getTime(),f=Math.max(0,16-(d-a)),e=window.setTimeout(function(){return b(d+f)},f),a=d+f,e});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(a){return window.clearTimeout(a)}})).call(this),CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return c<2*e&&(e=c/2),d<2*e&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},window.addEventListener||(window.addEventListener=function(a,b,c){return window.attachEvent?window.attachEvent("on"+a,b):window["on"+a]=b}),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)}),window.module||(window.module=!1);var Constants;Constants={SCALE:.1,SCALE_INV:10,BOTTOM:60,BASE_WIDTH:480,BASE_HEIGHT:268,JUMP_ACCEL:-38,MOVE_ACCEL:25,POLE_WIDTH:8,POLE_HEIGHT:64,GRAVITY:.15,ARROW_WIDTH:121,SET_DELAY:800,WIN_SCORE:6,POINT_WIDTH:20,SCOREBOARD_PADDING:20,BACK_BTN_WIDTH:108,BACK_BTN_HEIGHT:26,BALL_START_HEIGHT:260,SLIME_RADIUS:32,SLIME_MASS:3.5,SLIME_JUMP:10,BALL_RADIUS:10,BALL_MASS:1.4,HELPER_SIZE:10,MOVEMENT_SPEED:5,JUMP_SPEED:12,SLIME_START_HEIGHT:91,AI_DIFFICULTY:.45,MSG_FONT:"Courier, monospace, sans-serif",FPS_RATIO:1.5,TICK_DURATION:24,FRAME_DELAY:5,STATE_SAVE:200,SAVE_LIFETIME:5e3,TARGET_LATENCY:50,ASSETS:{p1:"assets/images/s_0.png",p2:"assets/images/s_1.png",bg:"assets/images/bg.png",ball:"assets/images/ball.png",eye:"assets/images/eye.png",menu_bg:"assets/images/menu_bg.png",logo:"assets/images/logo.png",btn_one:"assets/images/btn_one.png",btn_options:"assets/images/btn_options.png",btn_wifi:"assets/images/btn_wifi.png",btn_a:"assets/images/btn_a.png",btn_b:"assets/images/btn_b.png",pole:"assets/images/pole.png",blank_point:"assets/images/blank_point.png","return":"assets/images/return.png",score_a:"assets/images/score_a.png",score_b:"assets/images/score_b.png",back_arrow:"assets/images/back_arrow.png",options:"assets/images/options.png",btn_leaderboards:"assets/images/btn_leaderboards.png",btn_ai:"assets/images/btn_ai.png",btn_multi:"assets/images/btn_multi.png"}},module&&(module.exports=Constants);var Helpers;Helpers={round:function(a){return.5+a<<0},inRect:function(a,b,c,d,e,f){return a>c&&a<c+e&&b>d&&b<d+f},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI},yFromAngle:function(a){return-Math.cos(Helpers.deg2Rad(a))},xFromAngle:function(a){return Math.sin(Helpers.deg2Rad(a))},rand:function(a){return Math.floor(Math.random()*(a+1))},dist:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},mag:function(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}},module&&(module.exports=Helpers);var SceneManager;SceneManager=function(){function a(a){this.canvas=a,this.sceneStack=[],this.currScene=null}return a.prototype.pushScene=function(a){return this.sceneStack.push(a),this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),this.currScene=a,this.currScene.ctx=this.ctx,this.currScene.initialized?this.currScene.start():this.currScene.init()},a.prototype.popScene=function(){var a;return this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),a=this.sceneStack.pop(),a&&a.destroy&&a.destroy(),this.currScene=this.sceneStack[this.sceneStack.length-1]||null,this.currScene&&(this.currScene.ctx=this.ctx,this.currScene.start()),a},a}();var Scene,__hasProp=Object.prototype.hasOwnProperty;Scene=function(){function a(){var a=this;this.stopped=!0,this.initialized=!1,this.lastTimeout=0,this.width=Globals.Manager.canvas.width,this.height=Globals.Manager.canvas.height,this.center={x:this.width/2,y:this.height/2},this.canvas=Globals.Manager.canvas,this.ctx=this.canvas.getContext("2d"),this.buttons||(this.buttons={}),this.stepCallback=function(b){return a.step(b)}}return a.prototype.init=function(){return this.stopped=!1,this.initialized=!0,this.step((new Date).getTime())},a.prototype.start=function(){return this.stopped=!1,this.step((new Date).getTime())},a.prototype.step=function(a){},a.prototype.next=function(){if(!this.stopped)return this.lastTimeout=window.requestAnimationFrame(this.stepCallback)},a.prototype.stop=function(){return this.stopped=!0,window.cancelAnimationFrame(this.lastTimeout)},a.prototype.click=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleClick(a))}return e},a.prototype.mousedown=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseDown(a))}return e},a.prototype.mousemove=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseMove(a))}return e},a.prototype.mouseup=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseUp(a))}return e},a.prototype.mouseout=function(a){},a.prototype.buttonPressed=function(){},a}();var Loader;Loader=function(){function a(){this.progress=0,this.assets={},this.totalAssets=0,this.loadedAssets=0}return a.prototype.updateProgress=function(){this.progress=this.loadedAssets/this.totalAssets,this.onprogress&&this.onprogress(this.progress);if(this.progress===1&&this.onload)return this.onload()},a.prototype.load=function(a){var b,c,d;d=[];for(c in a)b=a[c],d.push(this.loadAsset(c,b));return d},a.prototype.loadAsset=function(a,b){var c,d,e;return d=new Image,e=this,d.onload=function(){return this.loaded=!0,e.loadedAssets++,e.updateProgress()},this.assets[a]={loader:this,src:b,image:d},this.totalAssets++,c=window&&window.basePath?window.basePath:"",d.src=c+b},a.prototype.loadProgress=function(a){return this.onprogress=a},a.prototype.loadComplete=function(a){return this.onload=a},a.prototype.getAsset=function(a){return this.assets[a].image},a}();var Input,__hasProp=Object.prototype.hasOwnProperty;Input=function(){function a(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this;this.keys={},this.wasdEnabled=!0,k=function(a){return a.which||(a.which=a.charCode),a.which||(a.which=a.keyCode),a},j=function(a){var b,c;return c=Globals.Manager.canvas,b=c.getBoundingClientRect(),a.x=(a.x-b.left)*(c.width/b.width),a.y=(a.y-b.top)*(c.height/b.height),a},l=function(a){var b,c,d;return b=Globals.Manager.canvas,c=a.clientX||a.x||a.layerX,d=a.clientY||a.y||a.layerY,j({x:c,y:d,identifier:a.identifier})},c=function(a){return m.keys["key"+k(a).which]=!0},d=function(a){return m.keys["key"+k(a).which]=!1},h=function(a){return a=l(a),Globals.Manager.currScene.mouseup(a)},e=function(a){return a=l(a),Globals.Manager.currScene.mousedown(a)},f=function(a){return a=l(a),Globals.Manager.currScene.mousemove(a)},b=function(a){return a=l(a),Globals.Manager.currScene.click(a)},g=function(a){return a=l(a),Globals.Manager.currScene.mouseout(a)},i=function(a){return function(a){return function(b){var c,d,e,f;b.preventDefault(),f=b.changedTouches;for(d=0,e=f.length;d<e;d++)c=f[d],a({x:c.clientX,y:c.clientY,identifier:c.identifier})}}.call(this,a)},a=Globals.Manager.canvas,document.addEventListener("keydown",c,!0),document.addEventListener("keyup",d,!0),a.addEventListener("mouseup",h,!0),a.addEventListener("mousedown",e,!0),a.addEventListener("mousemove",f,!0),a.addEventListener("mouseout",g,!0),a.addEventListener("click",b,!0),a.addEventListener("touchstart",i(e),!0),a.addEventListener("touchend",i(h),!0),a.addEventListener("touchmove",i(f),!0),a.addEventListener("touchcancel",i(h),!0),this.shortcuts={left:["key37","key65"],right:["key39","key68"],up:["key38","key87"]}}return a.prototype.left=function(a){return this.keys[this.shortcuts.left[1-a]]||this.wasdEnabled&&this.keys[this.shortcuts.left[a]]||!1},a.prototype.right=function(a){return this.keys[this.shortcuts.right[1-a]]||this.wasdEnabled&&this.keys[this.shortcuts.right[a]]||!1},a.prototype.up=function(a){return this.keys[this.shortcuts.up[1-a]]||this.wasdEnabled&&this.keys[this.shortcuts.up[a]]||!1},a.prototype.reset=function(){var a,b,c,d;c=this.keys,d=[];for(a in c)b=c[a],d.push(this.keys[a]=!1);return d},a.prototype.getState=function(a){return{left:this.left(a),right:this.right(a),up:this.up(a)}},a.prototype.set=function(a,b,c){return c==null&&(c=0),this.keys[this.shortcuts[a][c]]=b},a.prototype.setState=function(a,b){var c,d,e;b==null&&(b=0),e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],e.push(this.keys[this.shortcuts[c][b]]=d)}return e},a}();var Constants,Sprite;module&&(Constants=require("./constants")),Sprite=function(){function a(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.bg=e,this.velocity||(this.velocity={x:0,y:0}),this.acceleration||(this.acceleration={x:0,y:Constants.GRAVITY}),this.mass||(this.mass=1)}return a.prototype.setPosition=function(a,b){return b||(a.y&&(b=a.y),a.x&&(a=a.x)),this.x=a,this.y=b},a.prototype.incrementPosition=function(a){return this.x+=this.velocity.x*a*Constants.FPS_RATIO,this.y+=this.velocity.y*a*Constants.FPS_RATIO,this.velocity.x+=this.acceleration.x*this.mass*a*Constants.FPS_RATIO,this.velocity.y+=this.acceleration.y*this.mass*a*Constants.FPS_RATIO},a.prototype.draw=function(a,b,c){b||(b=this.x),c||(c=this.y);if(this.bg)return a.drawImage(this.bg,Helpers.round(b),Helpers.round(c))},a.prototype.getState=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,velocity:{x:this.velocity.x,y:this.velocity.y}}},a.prototype.setState=function(a){if(!a)return;return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.velocity={x:a.velocity.x,y:a.velocity.y}},a}(),module&&(module.exports=Sprite);var Button,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Button=function(a){function b(a,c,d,e,f,g,h){this.x=a,this.y=c,this.width=d,this.height=e,this.img=f,this.downImg=g,this.scene=h,this.down=!1,b.__super__.constructor.call(this,this.x,this.y,this.width,this.height,this.img)}return __extends(b,a),b.prototype.handleMouseDown=function(a){return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},b.prototype.handleMouseUp=function(a){return this.down&&Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)&&this.scene&&this.scene.buttonPressed(this),this.down=!1},b.prototype.handleMouseMove=function(a){if(this.down)return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},b.prototype.handleClick=function(a){return this.down=!1},b.prototype.draw=function(a){if(!this.img)return;return a.drawImage(this.down?this.downImg:this.img,Helpers.round(this.x),Helpers.round(this.y))},b}(Sprite);var GamePad;GamePad=function(){function a(a){this.btnRects=a,this.previousPos={}}return a.prototype.inRect=function(a,b){return a?Helpers.inRect(a.x,a.y,b[0],b[1],b[2],b[3]):!1},a.prototype.findRect=function(a){var b,c,d;d=this.btnRects;for(b in d){c=d[b];if(this.inRect(a,c))return b}return null},a.prototype.savePreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]=a},a.prototype.getPreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]},a.prototype.handleMouseDown=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!0),this.savePreviousPos(a)},a.prototype.handleMouseMove=function(a){var b,c,d;if(!a.identifier)return;b=this.findRect(a),d=this.getPreviousPos(a),c=d?this.findRect(d):null,this.savePreviousPos(a);if(c&&b===c)return Globals.Input.set(c,!0);if(c&&b!==c){Globals.Input.set(c,!1);if(b)return Globals.Input.set(b,!1)}},a.prototype.handleMouseUp=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!1),this.savePreviousPos(a)},a.prototype.handleClick=function(){},a}();var Globals;Globals={Input:null,Manager:new SceneManager,Loader:new Loader};var StretchySprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};StretchySprite=function(a){function b(a,c,d,e,f,g,h){this.x=a,this.y=c,this.width=d,this.height=e,this.rightCap=f,this.topCap=g,this.bg=h,this.generateStretchedImage(),b.__super__.constructor.call(this,this.x,this.y,this.width,this.height)}return __extends(b,a),b.prototype.generateStretchedImage=function(){var a,b,c,d,e,f,g,h;return a=function(a,b){var c;return c=document.createElement("canvas"),c.width=a,c.height=b,c},f=a(this.width,2),c=a(8,this.height),g=f.getContext("2d"),g.drawImage(this.bg,0,this.topCap,this.bg.width,1,0,0,this.width,f.height),d=c.getContext("2d"),d.drawImage(this.bg,this.bg.width-this.rightCap-c.width,0,c.width,this.bg.height,0,this.height-this.bg.height,c.width,this.bg.height),this.stretchedImage=a(this.width,this.height),b=this.stretchedImage.getContext("2d"),b.drawImage(this.bg,this.x,this.y+this.height-this.bg.height),e=b.createPattern(c,"repeat-x"),b.fillStyle=e,b.fillRect(this.bg.width-this.rightCap,this.height-this.bg.height,this.width-this.bg.width,this.bg.height),h=b.createPattern(f,"repeat-y"),b.fillStyle=h,b.fillRect(0,this.topCap,this.width,this.height-this.bg.height),b.drawImage(this.bg,0,0,this.bg.width,this.topCap,0,0,this.width,this.topCap),b.drawImage(this.bg,this.bg.width-this.rightCap,0,this.rightCap,this.bg.height,this.width-this.rightCap,this.height-this.bg.height,this.rightCap,this.bg.height)},b.prototype.draw=function(a){return a.drawImage(this.stretchedImage,0,0)},b}(Sprite);var Ball,Constants,Helpers,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite"),Constants=require("./constants"),Helpers=require("./helpers")),Ball=function(a){function b(a,c){this.x=a,this.y=c,this.radius=Constants.BALL_RADIUS,this.falling=!0,typeof Globals!="undefined"&&(this.bg=Globals.Loader.getAsset("ball")),this.mass=Constants.BALL_MASS,b.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius*2,this.bg)}return __extends(b,a),b.prototype.collidesWith=function(a){return this.y+this.height<a.y+a.height&&Math.sqrt(Math.pow(this.x+this.radius-(a.x+a.radius),2)+Math.pow(this.y+this.radius-(a.y+a.radius),2))<this.radius+a.radius},b.prototype.resolveCollision=function(a){var b;return b=Helpers.rad2Deg(Math.atan(-(this.x+this.radius-(a.x+a.radius))/(this.y+this.radius-(a.y+a.radius)))),this.velocity.x=Helpers.xFromAngle(b)*(6.5+2*Constants.AI_DIFFICULTY)+.05*a.velocity.x,this.velocity.y=Helpers.yFromAngle(b)*(6.5+2*Constants.AI_DIFFICULTY)+.05*a.velocity.y},b}(Sprite),module&&(module.exports=Ball);var Constants,Slime,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite"),Constants=require("./constants")),Slime=function(a){function b(a,c,d,e){this.x=a,this.y=c,this.ball=d,this.isP2=e,this.radius=Constants.SLIME_RADIUS,this.score=0,typeof Globals!="undefined"&&(this.eyeImg=Globals.Loader.getAsset("eye"),this.bg=Globals.Loader.getAsset(this.isP2?"p2":"p1")),this.mass=Constants.SLIME_MASS,b.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius,this.bg)}return __extends(b,a),b.prototype.handleInput=function(a,b){var c;b==null&&(b=!0),c=this.isP2?1:0,a.left(c)?b&&this.velocity.x>-Constants.MOVEMENT_SPEED?this.acceleration.x=-Constants.MOVEMENT_SPEED/15:(this.acceleration.x=0,this.velocity.x=-Constants.MOVEMENT_SPEED):a.right(c)?b&&this.velocity.x<Constants.MOVEMENT_SPEED?this.acceleration.x=Constants.MOVEMENT_SPEED/15:(this.acceleration.x=0,this.velocity.x=Constants.MOVEMENT_SPEED):(this.acceleration.x=0,this.velocity.x=0);if(a.up(c)&&this.y>=Constants.BASE_HEIGHT-Constants.BOTTOM-this.height)return this.velocity.y=-Constants.SLIME_JUMP},b.prototype.draw=function(a){var c,d,e,f,g,h;return b.__super__.draw.call(this,a),h=this.radius/2,g=h*.95,this.isP2&&(g=-g),e=[this.x+g,this.y-h],f=[g,h],c=[this.ball.x,this.ball.y],c[0]-=e[0],c[1]-=e[1],c[1]=-c[1],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),c[0]=c[0]/d*3+f[0],c[1]=c[1]/d*3+f[1],a.drawImage(this.eyeImg,Helpers.round(this.x+c[0]-2+this.radius),Helpers.round(this.y-c[1]-2+this.radius))},b}(Sprite),module&&(module.exports=Slime);var Scoreboard,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Scoreboard=function(a){function b(a,c,d,e){this.x=a,this.y=c,this.bgImg=d,this.slime=e,this.blankImg=Globals.Loader.getAsset("blank_point"),this.pointImg=Globals.Loader.getAsset("ball"),b.__super__.constructor.call(this,this.x,this.y,Constants.POINT_WIDTH*Constants.WIN_SCORE,Constants.POINT_WIDTH)}return __extends(b,a),b.prototype.draw=function(a){var b,c,d,e,f;c=Constants.POINT_WIDTH,a.drawImage(this.bgImg,this.x,this.y);for(b=0,d=this.slime.score;0<=d?b<d:b>d;0<=d?b++:b--)a.drawImage(this.pointImg,this.x+b*c+3,this.y+2);for(b=e=this.slime.score,f=Constants.WIN_SCORE;e<=f?b<f:b>f;e<=f?b++:b--)a.drawImage(this.blankImg,this.x+b*c+3,this.y+2)},b}(Sprite);var Social;Social=function(){function a(){}return a.tweet=function(){var a;return a=new Clay.Twitter,a.post("Check out this game, Slime Volley, on clay.io - http://slime.clay.io")},a.facebook=function(){var a;return a=new Clay.Facebook,a.post("Check out this game, Slime Volley, on clay.io - http://slime.clay.io")},a}();var Ball,Constants,Helpers,Slime,Sprite,World;module&&(Constants=require("./constants"),Helpers=require("./helpers"),Sprite=require("./sprite"),Slime=require("./slime"),Ball=require("./ball")),World=function(){function a(a,b,c){this.width=a,this.height=b,this.input=c,this.lastStep=null,this.clock=0,this.numFrames=1,this.ball=new Ball(this.width/4-Constants.BALL_RADIUS,this.height-Constants.BALL_START_HEIGHT,Constants.BALL_RADIUS),this.p1=new Slime(this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,this.ball,!1),this.p2=new Slime(3*this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,this.ball,!0),this.pole=new Sprite(this.width/2-Constants.POLE_WIDTH/2,this.height-Constants.BOTTOM-Constants.POLE_HEIGHT-1,Constants.POLE_WIDTH,Constants.POLE_HEIGHT),this.deterministic=!0,this.multiplayer=!1,this.onCollision=!1}return a.prototype.reset=function(a){return this.p1.setPosition(this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT),this.input.setState({left:!1,right:!1,up:!1},0),this.p2.setPosition(3*this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT),this.input.setState({left:!1,right:!1,up:!1},1),this.ball.setPosition((this.p2===a?3:1)*this.width/4-Constants.BALL_RADIUS,this.height-Constants.BALL_START_HEIGHT),this.pole.setPosition(this.width/2-4,this.height-60-64-1,8,64),this.p1.velocity={x:0,y:0},this.p2.velocity={x:0,y:0},this.ball.velocity={x:0,y:2},this.ball.falling=!0,this.p1.falling=this.p2.falling=!1,this.p1.jumpSpeed=this.p2.jumpSpeed=0,this.p1.gravTime=this.ball.gravTime=this.p2.gravTime=0},a.prototype.resolveCollision=function(a,b){var c,d,e,f,g;return e=a.radius+b.radius,c={x:a.x+a.radius,y:a.y+a.radius},d={x:b.x+b.radius,y:b.y+b.radius},f={x:c.x-d.x,y:c.y-d.y},g=Helpers.mag(f),f.x/=g,f.y/=g,f.x*=e,f.y*=e,{x:f.x+d.x-a.radius,y:f.y+d.y-a.radius}},a.prototype.step=function(a,b){var c,d,e,f,g,h,i;h=(new Date).getTime(),i=Constants.TICK_DURATION,this.lastStep&&(a||(a=h-this.lastStep)),a||(a=i),b||(this.lastStep=h);if(a>=1.3*i&&this.deterministic){while(a>0)g=a>=1.3*i?i:a,this.step(g,b),a-=g;return}this.deterministic&&(a=i),this.numFrames=a/i,this.clock+=a,this.handleInput(),this.ball.incrementPosition(this.numFrames),this.p1.incrementPosition(this.numFrames),this.p2.incrementPosition(this.numFrames),this.boundsCheck(),this.p1.y+this.p1.height>this.height-Constants.BOTTOM&&(this.p1.y=this.height-Constants.BOTTOM-this.p1.height,this.p1.velocity.y=Math.min(this.p1.velocity.y,0)),this.p2.y+this.p2.height>this.height-Constants.BOTTOM&&(this.p2.y=this.height-Constants.BOTTOM-this.p2.height,this.p2.velocity.y=Math.min(this.p2.velocity.y,0)),this.ball.y+this.ball.height>=this.height-Constants.BOTTOM&&(this.ball.y=this.height-Constants.BOTTOM-this.ball.height,this.ball.velocity.y=0),this.ball.collidesWith(this.p1)&&(this.ball.setPosition(this.resolveCollision(this.ball,this.p1)),this.ball.resolveCollision(this.p1),this.onCollision&&this.onCollision()),this.ball.collidesWith(this.p2)&&(this.ball.setPosition(this.resolveCollision(this.ball,this.p2)),this.ball.resolveCollision(this.p2),this.onCollision&&this.onCollision()),this.ball.x+this.ball.width>this.width?(this.ball.x=this.width-this.ball.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=-1),this.onCollision&&this.onCollision()):this.ball.x<0&&(this.ball.x=0,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=1),this.onCollision&&this.onCollision()),d=2;if(this.ball.x+this.ball.width>this.pole.x&&this.ball.x<this.pole.x+this.pole.width&&this.ball.y+this.ball.height>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height){this.ball.y+this.ball.radius>=this.pole.y+d?(this.ball.x=this.ball.velocity.x>0?this.pole.x-this.ball.width:this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y):this.ball.x+this.ball.radius<this.pole.x+d?(e={x:this.pole.x+d,y:this.pole.y+d,radius:d},f=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-e.x,2)+Math.pow(this.ball.y+this.ball.radius-e.y,2)),f<e.radius+this.ball.radius&&(this.ball.setPosition(this.resolveCollision(this.ball,e)),c=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(e.x+e.radius))/(this.ball.y+this.ball.radius-(e.y+e.radius)))),this.ball.velocity.x=Helpers.xFromAngle(c)*6,this.ball.velocity.y=Helpers.yFromAngle(c)*7)):this.ball.x+this.ball.radius>this.pole.x+this.pole.width-d?(e={x:this.pole.x+this.pole.width-d,y:this.pole.y+d,radius:d},f=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-e.x,2)+Math.pow(this.ball.y+this.ball.radius-e.y,2)),f<e.radius+this.ball.radius&&(this.ball.setPosition(this.resolveCollision(this.ball,e)),c=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(e.x+e.radius))/(this.ball.y+this.ball.radius-(e.y+e.radius)))),this.ball.velocity.x=Helpers.xFromAngle(c)*6,this.ball.velocity.y=Helpers.yFromAngle(c)*7)):(this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height);if(this.onCollision)return this.onCollision()}else if(this.ball.x<this.pole.x+this.pole.width&&this.ball.x>this.pole.x+this.ball.velocity.x&&this.ball.y>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height&&this.ball.velocity.x<0){this.ball.y+this.ball.height>=this.pole.y+d?(this.ball.x=this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y):(this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height);if(this.onCollision)return this.onCollision()}},a.prototype.boundsCheck=function(){this.p1.x<0&&(this.p1.x=0),this.p1.x+this.p1.width>this.pole.x&&(this.p1.x=this.pole.x-this.p1.width),this.p2.x<this.pole.x+this.pole.width&&(this.p2.x=this.pole.x+this.pole.width);if(this.p2.x>this.width-this.p2.width)return this.p2.x=this.width-this.p2.width},a.prototype.drawBallHelper=function(a){var b;return this.ctx=a,this.ctx.beginPath(),b=this.ctx.fillStyle,this.ctx.fillStyle="black",this.ctx.moveTo(this.ball.x+this.ball.radius,0),this.ctx.lineTo(this.ball.x+this.ball.radius-Constants.HELPER_SIZE,Constants.HELPER_SIZE),this.ctx.lineTo(this.ball.x+this.ball.radius+Constants.HELPER_SIZE,Constants.HELPER_SIZE),this.ctx.fill(),this.ctx.fillStyle=b},a.prototype.handleInput=function(){return this.p1.handleInput(this.input,!this.multiplayer),this.p2.handleInput(this.input,!this.multiplayer)},a.prototype.injectFrame=function(a){this.setFrame(a)},a.prototype.getState=function(){return{p1:this.p1.getState(),p2:this.p2.getState(),ball:this.ball.getState(),clock:this.clock}},a.prototype.setState=function(a){return this.p1.setState(a.p1),this.p2.setState(a.p2),this.ball.setState(a.ball)},a.prototype.getInput=function(){return{p1:this.input.getState(0),p2:this.input.getState(1)}},a.prototype.setInput=function(a){if(!a)return;a.p1&&this.input.setState(a.p1,0);if(a.p2)return this.input.setState(a.p2,1)},a.prototype.setFrame=function(a){if(!a)return;return this.setState(a.state),this.setInput(a.input)},a.prototype.getFrame=function(){return{state:this.getState(),input:this.getInput()}},a}(),module&&(module.exports=World);var LoadingScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};LoadingScene=function(a){function b(){this.loadStarted=!1,this.progress=0,b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.start=function(){var a;return a=this,this.loadStarted||(this.loadStarted=!0,Globals.Loader.loadProgress(function(b){return a.loadProgress(b,a)}),Globals.Loader.loadComplete(function(){return a.loadComplete()}),Globals.Loader.load(Constants.ASSETS)),b.__super__.start.call(this)},b.prototype.loadComplete=function(){return Globals.Manager.popScene(),Globals.Manager.pushScene(new MenuScene)},b.prototype.loadProgress=function(a,b){return this.progress=a,b.next()},b.prototype.step=function(a){if(!this.ctx)return;return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#444",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.strokeStyle="#111",this.ctx.lineWidth=1,this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).stroke(),this.ctx.fillStyle="#444",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).fill(),this.ctx.fillStyle="#0f0",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70*this.progress,10,2).fill(),this.ctx.font="12px Monaco, Courier New, Courier, san-serif",this.ctx.textAlign="center",this.ctx.fillStyle="#bbb",this.ctx.fillText("Loading...",Helpers.round(this.center.x),Helpers.round(this.center.y+25))},b}(Scene);var MenuScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};MenuScene=function(a){function b(){var a,c,d,e,f,g,h,i,j,k,l,m=this;b.__super__.constructor.call(this),g=Globals.Loader,this.bg=new StretchySprite(0,0,this.width,this.height,1,1,g.getAsset("menu_bg")),this.logo=new Sprite(this.center.x-128,this.center.y-155,256,256,g.getAsset("logo")),Clay.ready(function(){return m.clayRooms=new Clay.Rooms(function(a){var b;return b=new NetworkSlimeVolleyball,b.roomID=a.id,b.rooms=a.instance,Globals.Manager.pushScene(b)})}),d=this.center.y+30,c=234,a=44,h=58,this.buttons={leaderboards:new Button((this.center.x-c)/2,d+h,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this),onePlayer:new Button((this.center.x-c)/2,d,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this),options:new Button(this.center.x+(this.center.x-c)/2,d+h,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this),wifi:new Button(this.center.x+(this.center.x-c)/2,d,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this)},this.labels=[],f=["btn_wifi","btn_options","btn_one","btn_leaderboards"],l=["leaderboards","onePlayer","options","wifi"],i=function(a){return this.labels.push(new Sprite(a.x,a.y,a.width,a.height,g.getAsset(f.pop())))};for(j=0,k=l.length;j<k;j++)e=l[j],i.call(this,this.buttons[e])}return __extends(b,a),b.prototype.step=function(a){var b,c,d,e,f,g,h;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.logo.draw(this.ctx),g=this.buttons;for(c in g)b=g[c],b.draw(this.ctx);h=this.labels;for(e=0,f=h.length;e<f;e++)d=h[e],d.draw(this.ctx);return this.logo.y+=Math.sin(Math.PI/180*this.logo.velocity.y)/3,this.logo.velocity.y+=2},b.prototype.buttonPressed=function(a){if(a===this.buttons.leaderboards)return(new Clay.Leaderboard({id:6})).show({filters:["day","month","all"],tabs:[{id:5,filters:["day","month","all"]}]},function(a){return console.log(a)});if(a===this.buttons.onePlayer)return Globals.Manager.pushScene(new OpponentSelectScene);if(a===this.buttons.options)return Globals.Manager.pushScene(new OptionsScene);if(a===this.buttons.wifi)return this.clayRooms.show()},b}(Scene);var OpponentSelectScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};OpponentSelectScene=function(a){function b(){var a,c,d,e,f,g,h,i,j,k,l;b.__super__.constructor.call(this),g=Globals.Loader,this.bg=new StretchySprite(0,0,this.width,this.height,1,1,g.getAsset("menu_bg")),d=100,c=234,a=44,h=58,this.buttons={back:new Button(10,10,50,50,g.getAsset("back_arrow"),g.getAsset("back_arrow"),this),multi:new Button(this.center.x-c/2,d+h,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this),ai:new Button(this.center.x-c/2,d,c,a,g.getAsset("btn_a"),g.getAsset("btn_b"),this)},f=["btn_multi","btn_ai"],this.labels=[],l=["ai","multi"],i=function(a){return this.labels.push(new Sprite(a.x,a.y,a.width,a.height,g.getAsset(f.pop())))};for(j=0,k=l.length;j<k;j++)e=l[j],i.call(this,this.buttons[e])}return __extends(b,a),b.prototype.step=function(a){var b,c,d,e,f,g,h,i;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=2,c=270,this.ctx.roundRect(this.width/2-c/2,20,c,c-50,11).fill(),this.ctx.stroke(),h=this.buttons;for(d in h)b=h[d],b.draw(this.ctx);i=this.labels;for(f=0,g=i.length;f<g;f++)e=i[f],e.draw(this.ctx);return this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="black",this.ctx.textAlign="center",this.ctx.fillText("Select an opponent:",this.width/2,65)},b.prototype.buttonPressed=function(a){var b;Globals.Manager.popScene();if(a===this.buttons.multi)return b=new SlimeVolleyball,b.isLocalMultiplayer=!0,Globals.Manager.pushScene(b);if(a===this.buttons.ai)return Globals.Manager.pushScene(new SlimeVolleyball)},b}(Scene);var SlimeVolleyball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};SlimeVolleyball=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(a){var c,d,e=this;this.world||(this.world=new World(this.width,this.height,Globals.Input)),this.world.deterministic=!1,d=Globals.Loader,this.world.pole.bg=d.getAsset("pole"),this.bg=new StretchySprite(0,0,this.width,this.height,200,1,d.getAsset("bg")),this.p1Scoreboard=new Scoreboard(Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,d.getAsset("score_a"),this.world.p1),this.p2Scoreboard=new Scoreboard(this.width-Constants.WIN_SCORE*Constants.POINT_WIDTH-Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,d.getAsset("score_b"),this.world.p2),this.buttons={back:new Button(this.width/2-Constants.BACK_BTN_WIDTH/2,Constants.SCOREBOARD_PADDING,Constants.BACK_BTN_WIDTH,Constants.BACK_BTN_HEIGHT,d.getAsset("return"),d.getAsset("return"),this)};try{this.percent=document.cookie.match(/AI_DIFFICULTY=(\d\.\d*)/i)[1]}catch(f){this.percent=Constants.AI_DIFFICULTY}finally{Constants.AI_DIFFICULTY=this.percent}return this.sprites=[],this.sprites.push
(this.bg,this.world.pole,this.world.p1,this.world.p2,this.world.ball,this.p1Scoreboard,this.p2Scoreboard,this.buttons.back),c=new GamePad({left:[0,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],right:[Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],up:[2*Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,this.width-2*Constants.ARROW_WIDTH,Constants.BOTTOM]}),this.buttons.gamepad=c,this.failMsgs=["you failed miserably!","try harder, young one.","not even close!","he wins, you lose!",'"hahaha!" shouts your opponent.',"*** YOU LOST THE GAME ***"],this.winMsgs=["nice shot!","good job!","you've got this!","keep it up!","either you're good, or you got lucky!","*** YOU WON THE GAME ***"],this.displayMsg=null,this.freezeGame=!1,this.keyState={left:!1,right:!1,up:!1},this.isLocalMultiplayer&&(Globals.Input.wasdEnabled=!1),a||(this.world.handleInput=function(){return e.world.p1.handleInput(Globals.Input),e.isLocalMultiplayer?e.world.p2.handleInput(Globals.Input):(e.moveCPU.apply(e.world),e.world.onCollision=function(){return this.sweetSpot=null})}),b.__super__.init.call(this)},b.prototype.inputChanged=function(){var a,b,c,d,e,f;c=Globals.Input,a=!1,f=this.keyState;for(d in f){if(!__hasProp.call(f,d))continue;e=f[d],b=c[d](0),e!==b&&(a||(a={}),a[d]=b,this.keyState[d]=b)}return a},b.prototype.moveCPU=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(this.freezeGame)return;b={x:this.ball.x,y:this.ball.y,velocity:{x:this.ball.velocity.x,y:this.ball.velocity.y},acceleration:{x:this.ball.acceleration.x,y:this.ball.acceleration.y}},f=this.height-Constants.BOTTOM;while(b.y<f-this.p2.height){if(b.x>this.width&&b.velocity.x>0||b.x<0&&b.velocity.x<0)b.velocity.x*=-1,b.velocity.y=Helpers.yFromAngle(180-b.velocity.x/b.velocity.y)*b.velocity.y,Math.abs(b.velocity.x)<=.1&&(b.velocity.x=1);b.x+=b.velocity.x*Constants.FPS_RATIO,b.y+=b.velocity.y*Constants.FPS_RATIO,b.velocity.y+=b.acceleration.y*this.ball.mass*Constants.FPS_RATIO,b.y+b.height>=f&&(b.y=this.height-Constants.BOTTOM-b.height,b.velocity.y=0)}e=this.ball.x+this.ball.radius,h=this.p2.x+this.p2.width/2,i=this.ball.x>this.p1.x+this.p1.width/2+this.ball.radius,j=b.x>this.pole.x,d=b.x+this.ball.radius,c=Math.atan2(d-e,this.ball.y),this.sweetSpot||(a=Math.atan2(b.velocity.x,b.velocity.y),l=b.velocity.x<0?-1:1,k=3*Math.random()*l,Math.random()<.25-.23*Constants.AI_DIFFICULTY&&(k+=(.75+Math.random()*.25)*27*(1.7-Constants.AI_DIFFICULTY*.7)),g=Math.atan(a)*this.p2.height,g-=k,g-=10*((d-this.pole.x)/(this.width/2)),g-=12*Constants.AI_DIFFICULTY+.2*(1.57-Math.abs(a)),this.sweetSpot=d-g),m=this.sweetSpot,j&&Math.abs(e-d)<5&&Math.abs(h-m)<=6&&this.ball.y<300&&this.ball.y>50&&this.p2.velocity.y===0&&c>-1.2&&c<1.2&&(this.p2.velocity.y=-8);if(m>h+5)return this.p2.x+=Constants.MOVEMENT_SPEED*.55+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY*.5;if((i&&j||this.ball.velocity.x<0&&this.ball.x>this.pole.x)&&m<h-5)return this.p2.x-=Constants.MOVEMENT_SPEED*.55+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY*.7},b.prototype.draw=function(){var a,b,c,d,e;this.ctx.clearRect(0,0,this.width,this.height),e=this.sprites;for(c=0,d=e.length;c<d;c++)b=e[c],b.draw(this.ctx);this.world.ball.y<0&&this.world.drawBallHelper(this.ctx);if(this.displayMsg){this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",a=this.displayMsg.split("\n"),this.ctx.fillText(a[0],this.width/2,85);if(a.length>1)return this.ctx.font="bold 11px "+Constants.MSG_FONT,this.ctx.fillText(a[1],this.width/2,110)}},b.prototype.handleWin=function(a){var b,c,d,e=this;return this.freezeGame=!0,a.score++,this.world.ball.y=this.height-Constants.BOTTOM-this.world.ball.height,this.world.ball.velocity={x:0,y:0},this.world.ball.falling=!1,this.world.sweetSpot=null,a===this.world.p1?(d=this.winMsgs,a.score>=Constants.WIN_SCORE&&(b=new Clay.Leaderboard(5),b.post(1))):d=this.failMsgs,c=a.score<Constants.WIN_SCORE?Helpers.rand(d.length-2):d.length-1,a===this.world.p1&&!this.hasPointAchiev&&((new Clay.Achievement({id:15})).award(),this.hasPointAchiev=!0),a===this.world.p1&&a.score>=Constants.WIN_SCORE&&!this.hasWinAchiev&&((new Clay.Achievement({id:14})).award(),this.hasWinAchiev=!0),this.displayMsg=d[c],a.score<Constants.WIN_SCORE?(this.displayMsg+="\nGame restarts in 1 second...",setTimeout(function(){return e.world.reset(a),e.displayMsg=null,e.stepLen=Constants.TICK_DURATION,e.freezeGame=!1},1e3)):(this.displayMsg+="\nPress the enter key to play again",window.addEventListener("keydown",function(a){if(a.which===13)return e.world.reset(),e.displayMsg=null,e.stepLen=Constants.TICK_DURATION,e.freezeGame=!1,e.world.p1.score=0,e.world.p2.score=0,window.removeEventListener("keydown",arguments.callee)}))},b.prototype.step=function(a){var b;return this.next(),this.freezeGame?this.draw():(this.world.step(this.stepLen),this.stepLen=null,this.world.ball.y+this.world.ball.height>=this.world.height-Constants.BOTTOM&&(b=this.world.ball.x+this.world.ball.radius>this.width/2?this.world.p1:this.world.p2,this.handleWin(b)),this.draw())},b.prototype.buttonPressed=function(a){return Globals.Input.wasdEnabled=!0,Globals.Manager.popScene()},b}(Scene);var InputSnapshot,__hasProp=Object.prototype.hasOwnProperty;InputSnapshot=function(){function a(){this.states=[{left:!1,right:!1,up:!1},{left:!1,right:!1,up:!1}]}return a.prototype.get=function(a,b){return this.states[b][a]},a.prototype.getState=function(a){var b,c,d,e;c={},e=this.states[a];for(b in e){if(!__hasProp.call(e,b))continue;d=e[b],c[b]=d}return c},a.prototype.setState=function(a,b){var c,d,e;e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],e.push(this.states[b][c]=a[c])}return e},a.prototype.left=function(a){return this.states[a].left},a.prototype.right=function(a){return this.states[a].right},a.prototype.up=function(a){return this.states[a].up},a}(),module&&(module.exports=InputSnapshot);var NetworkSlimeVolleyball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};NetworkSlimeVolleyball=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(){var a=this;return this.world=new World(this.width,this.height,new InputSnapshot),b.__super__.init.call(this,!0),this.freezeGame=!0,this.displayMsg="Loading...",this.step(),this.receivedFrames=[],this.world.deterministic=!0,this.world.multiplayer=!0,this.msAhead=Constants.TARGET_LATENCY,this.stepCallback=function(){return a.step()},this.socket&&this.socket.disconnect()&&(this.socket=null),this.socket=io.connect("http://clay.io:845",{"force new connection":!0,reconnect:!1}),this.socket.on("connect",function(){return a.displayMsg="Connected. Waiting for opponent...",a.joinRoom()}),this.socket.on("gameInit",function(b){return a.displayMsg="Opponent found! Game begins in 1 second...",a.world.setFrame(b)}),this.socket.on("gameStart",function(b){return a.freezeGame=!1,a.displayMsg=null,a.world.setFrame(b),a.receivedFrames=[],a.start()}),this.socket.on("gameFrame",function(b){return a.msAhead=a.world.clock-b.state.clock,a.receivedFrames.push(b)}),this.socket.on("gameWin",function(a){var b;return b=new Clay.Leaderboard({id:6}),b.post({jwt:a})}),this.socket.on("roundEnd",function(b){var c;return c=function(){a.freezeGame=!0,a.world.ball.y=a.height-Constants.BOTTOM-2*a.world.ball.radius,b?(a.displayMsg=a.winMsgs[Helpers.rand(a.winMsgs.length-2)],a.hasPointAchiev||((new Clay.Achievement({id:15})).award(),a.hasPointAchiev=!0),a.world.p1.score+=1):(a.displayMsg=a.failMsgs[Helpers.rand(a.winMsgs.length-2)],a.world.p2.score+=1);if(a.world.p1.score>=Constants.WIN_SCORE||a.world.p2.score>=Constants.WIN_SCORE)a.world.p1.score>=Constants.WIN_SCORE?(a.hasWinAchiev||((new Clay.Achievement({id:14})).award(),a.hasWinAchiev=!0),a.displayMsg="You WIN!!!"):a.displayMsg="You LOSE.",a.displayMsg+="New game starting in 3 seconds",a.world.p1.score=0,a.world.p2.score=0;return a.stop()},setTimeout(c,Constants.TARGET_LATENCY)}),this.socket.on("gameDestroy",function(b){if(a.socket)return a.freezeGame=!0,a.socket=null,a.displayMsg="Lost connection to opponent.",a.stop(),setTimeout(function(){return Globals.Manager.sceneStack[Globals.Manager.sceneStack.length-2]&&Globals.Manager.popScene(),a.rooms.leaveRoom()},2e3)}),this.socket.on("disconnect",function(){if(a.socket)return a.freezeGame=!0,a.socket=null,a.displayMsg="Lost connection to opponent.",a.stop(),setTimeout(function(){return Globals.Manager.sceneStack[Globals.Manager.sceneStack.length-2]&&Globals.Manager.popScene(),a.rooms.leaveRoom()},2e3)}),this.socketInitialized=!0},b.prototype.joinRoom=function(){var a;a={roomID:this.roomID,playerID:Clay.player.identifier};if(this.roomID)return this.socket.emit("joinRoom",a)},b.prototype.start=function(){return this.step(),this.gameInterval=setInterval(this.stepCallback,Constants.TICK_DURATION)},b.prototype.draw=function(){var a,b;if(!this.ctx)return;a=this.world.getState(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.world.p1.draw(this.ctx,a.p1.x,a.p1.y),this.world.p2.draw(this.ctx,a.p2.x,a.p2.y),this.world.ball.draw(this.ctx,a.ball.x,a.ball.y),this.world.pole.draw(this.ctx),this.p1Scoreboard.draw(this.ctx),this.p2Scoreboard.draw(this.ctx),this.buttons.back.draw(this.ctx),this.world.ball.y<0&&this.world.drawBallHelper(this.ctx);if(this.displayMsg){this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",b=this.displayMsg.split("\n"),this.ctx.fillText(b[0],this.width/2,85);if(b.length>1)return this.ctx.font="bold 11px "+Constants.MSG_FONT,this.ctx.fillText(b[1],this.width/2,110)}},b.prototype.handleInput=function(){var a,b;if(!this.freezeGame){a=this.inputChanged();if(a)return b={input:{p1:a}},this.socket.emit("input",b)}},b.prototype.stop=function(){return this.draw(),clearInterval(this.gameInterval)},b.prototype.step=function(a){var b;if(this.receivedFrames)while(this.receivedFrames.length>0)b=this.receivedFrames.shift(),this.freezeGame||this.world.injectFrame(b);this.handleInput();if(this.freezeGame||!this.socketInitialized){this.draw();return}return this.world.step(Constants.TICK_DURATION),this.draw()},b.prototype.destroy=function(){if(this.socket)return this.socket.disconnect()},b}(SlimeVolleyball);var InstructionsScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};InstructionsScene=function(a){function b(){var a;b.__super__.constructor.call(this),this.bg=new StretchySprite(0,0,this.width,this.height,1,1,Globals.Loader.getAsset("instructions")),a=Globals.Loader.getAsset("back_arrow"),this.buttons={back:new Button(10,10,50,50,a,a,this)}}return __extends(b,a),b.prototype.step=function(a){var b,c,d,e;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),d=this.buttons,e=[];for(c in d)b=d[c],e.push(b.draw(this.ctx));return e},b.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},b}(Scene);var OptionsScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};OptionsScene=function(a){function b(){var a;b.__super__.constructor.call(this),this.bg=new StretchySprite(0,0,this.width,this.height,1,1,Globals.Loader.getAsset("options")),a=Globals.Loader.getAsset("back_arrow"),this.buttons={back:new Button(10,10,50,50,a,a,this)},this.dragger=new Sprite(258,this.height-215-Constants.BALL_RADIUS,Constants.BALL_RADIUS*2,Constants.BALL_RADIUS*2,Globals.Loader.getAsset("ball"));try{this.percent=document.cookie.match(/AI_DIFFICULTY=(\d\.\d*)/i)[1]}catch(c){this.percent=Constants.AI_DIFFICULTY}finally{Constants.AI_DIFFICULTY=this.percent}this.mdown=!1}return __extends(b,a),b.prototype.step=function(a){var b,c,d;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),d=this.buttons;for(c in d)b=d[c],b.draw(this.ctx);return this.dragger.x=this.percent*192+258-this.dragger.width/2,this.dragger.draw(this.ctx)},b.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},b.prototype.mousedown=function(a){return Helpers.inRect(a.x,a.y,244,this.height-240,225,52)&&(this.mdown=!0,this.percent=Math.max(Math.min((a.x-244)/225,1),0),Constants.AI_DIFFICULTY=this.percent,document.cookie="AI_DIFFICULTY="+this.percent),b.__super__.mousedown.call(this,a)},b.prototype.mousemove=function(a){return this.mdown&&(this.percent=Math.max(Math.min((a.x-244)/225,1),0),Constants.AI_DIFFICULTY=this.percent,document.cookie="AI_DIFFICULTY="+this.percent),b.__super__.mousemove.call(this,a)},b.prototype.mouseup=function(a){return this.mdown=!1,b.__super__.mouseup.call(this,a)},b.prototype.mouseout=function(a){return this.mdown=!1,b.__super__.mouseout.call(this,a)},b}(Scene);var scrollTop;scrollTop=function(){var a;return a=setInterval(function(){var b,c;if(document.body){clearInterval(a),scrollTo(0,1),b=0,scrollTo(0,b===document.body.scrollTop?1:0),c=document.getElementById("please-rotate");if(window.innerWidth<350&&c)return c.style.display="block";if(c)return c.style.display="none"}},200)},window.addEventListener("orientationchange",function(){return scrollTop()}),window.fireUpSlime=function(){var a,b,c,d;return d=window.devicePixelRatio||1,a=document.getElementById("canvas"),document.body.clientHeight-100<window.innerHeight&&(c=document.createElement("div"),c.style.height=window.innerHeight-document.body.clientHeight+100+"px",document.getElementsByTagName("body")[0].appendChild(c)),scrollTop(),Globals.Manager.canvas=a,Globals.Manager.ctx=Globals.Manager.canvas.getContext("2d"),Globals.Input=new Input,b=new LoadingScene,Globals.Manager.pushScene(b),b.start()},window.addEventListener("load",function(){return window.fireUpSlime()});